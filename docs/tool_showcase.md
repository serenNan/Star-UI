# Tools Showcase 模块 - 视差滚动实现文档

## 📋 更新日志

**最后更新**：2025-11-03
**版本**：v2.0 - 视差滚动重构版
**修改人**：Claude Code

**重大变更**：
- ✅ 从 3D 深度层叠改为视差滚动卡片扩散效果
- ✅ 实现负边距重叠布局
- ✅ 中央卡片快速动画 + 左右卡片慢速动画
- ✅ 纯 CSS transition 实现视差效果

---

## 🎯 核心特性（v2.0）

### 1. 视差滚动效果

**核心理念**：通过不同速度的动画实现视差效果

**初始状态**：
- 左右卡片通过负边距与中央卡片重叠
- 左侧容器：`margin-right: -150px`
- 右侧容器：`margin-left: -150px`
- 所有卡片在同一 z-index 层级（`z-index: 1`）

**向下滚动（扩散效果）**：
```
时间轴：0s ────> 0.8s ────> 1.8s

中央卡片（快速，0.6s）：
  scale(1) ─快─> scale(1.5) ─快─> scale(1)

左右卡片（慢速，1.0s）：
  translateX(0) ─慢─> translateX(±100px) ─慢─> translateX(0)

结果：中央卡片放大速度 > 左右卡片移动速度
     → 中央卡片在动画中遮挡更多区域
```

**向上滚动（收缩效果）**：
- 相同动画，但视觉效果相反
- 中央卡片缩小速度 > 左右卡片回归速度
- 左右卡片逐渐从遮挡中露出

### 2. 动画时序设计

```javascript
// switchCard() 执行流程
0ms    → 添加 .expanded 类，触发扩散动画
400ms  → 切换图片内容（此时最模糊）
800ms  → 移除 .expanded 类，开始收缩
1800ms → 动画完成，重置标志
```

**CSS 动画配置**：
```css
/* 中央卡片 - 快速 */
.tools-showcase__card--main {
  transition: transform 0.6s cubic-bezier(0.4, 0.0, 0.2, 1);
}

/* 左右卡片 - 慢速 */
.tools-showcase__side {
  transition: transform 1.0s cubic-bezier(0.4, 0.0, 0.2, 1);
}
```

### 3. 功能列表

1. **工具类别切换**：4 个标签按钮（Image Generator、Video Generator、Timeline Editor、Avatar）
2. **视差滚动卡片**：展示每个工具的作品示例，支持鼠标滚轮切换
3. **卡片扩散效果**：中央卡片快速放大，左右卡片慢速外推
4. **行动号召**：RUN GENERATOR 按钮（白底黑字）
5. **响应式设计**：适配桌面端、平板、移动端

### ⚠️ 重要说明：标签切换逻辑

**4 个工具标签的作用仅仅是切换不同的演示图片集合，3D 轮播效果在所有工具类别中都相同。**

具体行为：
- **Image Generator 标签**：显示图片生成工具的演示作品（例如 5-7 张 AI 生成的图片）
- **Video Generator 标签**：显示视频生成工具的演示作品（例如 5-7 张视频缩略图）
- **Timeline Editor 标签**：显示时间线编辑器的演示作品（例如 5-7 张编辑界面截图）
- **Avatar 标签**：显示头像生成工具的演示作品（例如 5-7 张生成的头像）

**每个标签切换后**：
- 卡片内容更新为对应工具的图片集合
- 3D 轮播效果保持一致（中央放大、侧边堆叠）
- 鼠标滚轮交互方式不变
- 动画效果和参数完全相同

**数据结构示意**：
```
工具数据 = {
  "Image Generator": [图片1, 图片2, 图片3, 图片4, 图片5],
  "Video Generator": [图片1, 图片2, 图片3, 图片4, 图片5],
  "Timeline Editor": [图片1, 图片2, 图片3, 图片4, 图片5],
  "Avatar": [图片1, 图片2, 图片3, 图片4, 图片5]
}

当前显示的工具 = "Image Generator"
当前卡片数组 = 工具数据["Image Generator"]
```

点击标签时只是改变 "当前显示的工具"，然后用新工具的图片数组重新渲染 3D 轮播。

### 交互方式
- **主交互**：鼠标滚轮向上/向下切换卡片
- **辅助交互**：移动端支持触摸滑动
- **标签切换**：点击不同标签切换工具类别
- **未来扩展**：支持自动播放、键盘方向键控制

### 内容展示
- **当前阶段**：静态图片展示工具生成的作品
- **后期升级**：替换为视频内容，支持悬浮播放

---

## 🏗️ 结构设计

### 整体布局
模块采用垂直布局，从上到下包含以下区域：

1. **标题区域**
   - 主标题："Where Imagination Eclipses Reality"
   - 副标题或描述文字（可选）
   - 视觉层次：大标题 + 细小副标题

2. **工具标签栏**
   - 4 个并排的标签按钮
   - 当前选中标签有明显的视觉区分（高亮、下划线或背景色）
   - 标签文字：Image Generator、Video Generator、Timeline Editor、Avatar

3. **3D 卡片轮播容器**
   - 中央区域用于展示卡片
   - 卡片水平排列，但通过 3D 变换营造深度感
   - 卡片数量：每个工具类别 5-7 张示例图片
   - 可见卡片：桌面端同时显示 5 张（中间 1 张大 + 左右各 2 张小）

4. **行动号召按钮**
   - 位置：卡片轮播下方，居中显示
   - 文字："RUN GENERATOR" 或 "TRY IT NOW"
   - 样式：主色调按钮，带悬浮效果

### 响应式布局策略

**桌面端（宽度 ≥ 992px）**
- 同时显示 5 张卡片：中央 1 张 + 左右各 2 张
- 卡片尺寸：中央卡片约 600-800px 宽，侧边卡片按比例缩小
- 工具标签：水平排列
- 间距：宽松，留白充足

**平板端（768px ≤ 宽度 < 992px）**
- 同时显示 3 张卡片：中央 1 张 + 左右各 1 张
- 卡片尺寸：中央卡片约 500px 宽
- 工具标签：水平排列，可能需要缩小字号
- 间距：适中

**移动端（宽度 < 768px）**
- 仅显示 1 张卡片（中央卡片）
- 添加左右箭头按钮辅助切换（替代滚轮）
- 工具标签：可能改为横向滚动条或下拉选择
- 支持触摸滑动切换卡片
- 按钮：全宽或接近全宽

---

## 🎨 视觉设计细节

### 卡片样式

**基础外观**
- 形状：圆角矩形（border-radius: 16-24px）
- 宽高比：推荐 4:3 或 16:9（根据图片内容调整）
- 边框：细边框或渐变边框（可选）
- 阴影：深色阴影，增强深度感

**3D 层叠效果**
- 中央卡片（索引 0）：
  - 缩放比例：120%（放大）
  - Z 轴位置：0（最前）
  - 亮度：100%（正常）
  - 层级：z-index 最高

- 左右第一层（索引 ±1）：
  - 缩放比例：90%
  - Z 轴位置：向后移动 100px
  - 亮度：70%（略微变暗）
  - 层级：z-index 次高
  - 水平位移：左侧卡片向左移，右侧卡片向右移

- 左右第二层（索引 ±2）：
  - 缩放比例：75%
  - Z 轴位置：向后移动 200px
  - 亮度：40%（明显变暗）
  - 层级：z-index 更低
  - 水平位移：比第一层更远

- 左右第三层及以后（索引 ±3+）：
  - 逐渐缩小并隐藏（可选）
  - 或者保持在最远端等待轮播

**堆叠规则**
- 左侧卡片从右到左堆叠（越远的越靠左）
- 右侧卡片从左到右堆叠（越远的越靠右）
- 所有卡片的底部对齐（或中心对齐）
- 通过 z-index 确保中央卡片始终在最上层

### 工具标签样式

**默认状态**
- 背景：透明或半透明暗色
- 文字：浅色（白色或浅灰）
- 边框：细边框或无边框
- 内边距：上下 12px，左右 24px

**悬浮状态**
- 背景：略微变亮
- 文字：完全白色
- 过渡动画：0.3 秒平滑过渡

**激活状态（当前选中）**
- 背景：渐变色或主题色
- 文字：白色
- 下划线或底部边框：强调当前选中
- 可选：轻微的放大效果

### 动画效果

**卡片切换动画**
- 持续时间：0.6-0.8 秒
- 缓动函数：cubic-bezier(0.4, 0.0, 0.2, 1)（ease-out）
- 动画属性：
  - transform（translateX、translateZ、scale 同时变化）
  - opacity（可选，用于淡入淡出）
  - filter: brightness（亮度变化）

**动画流程**
1. 用户滚动鼠标滚轮
2. JavaScript 更新当前索引
3. 计算每张卡片的新位置、缩放、亮度
4. CSS transition 自动执行动画
5. 动画结束后，更新 z-index 层级

**性能优化要点**
- 使用 transform 而非 left/top/margin（启用 GPU 加速）
- 使用 will-change 属性提前通知浏览器
- 避免在动画过程中重绘和回流
- 节流滚轮事件（防止用户快速滚动时卡顿）

---

## 🖱️ 交互逻辑设计

### 鼠标滚轮切换

**监听逻辑**
- 监听 wheel 事件（鼠标滚轮）
- 区分滚轮方向：deltaY > 0（向下滚）切换到下一张，deltaY < 0（向上滚）切换到上一张
- 节流处理：150-200ms 内只处理一次滚轮事件，防止连续触发

**切换规则**
- 当前索引记录在 JavaScript 变量中（例如 currentIndex）
- 向下滚：currentIndex++（切换到下一张）
- 向上滚：currentIndex--（切换到上一张）
- 循环轮播：
  - 如果 currentIndex 超过最大索引，回到 0
  - 如果 currentIndex 小于 0，跳到最后一张

**边界处理**
- 确保索引不会越界
- 可选：到达末尾时禁用继续滚动（非循环模式）
- 可选：显示视觉提示（例如抖动）

### 标签切换

**点击逻辑**
- 监听每个标签按钮的 click 事件
- 更新当前选中的工具类别
- 切换卡片数据源（不同工具类别对应不同的图片数组）
- 重置 currentIndex 为 0（显示新类别的第一张）
- 更新标签的激活状态样式

**数据结构**
- 使用 JavaScript 对象或数组存储每个工具的卡片数据
- 数据结构示例概念：
  - Image Generator：[图片 1 路径, 图片 2 路径, ...]
  - Video Generator：[图片 1 路径, 图片 2 路径, ...]
  - Timeline Editor：[图片 1 路径, 图片 2 路径, ...]
  - Avatar：[图片 1 路径, 图片 2 路径, ...]

### 移动端触摸支持

**手势识别**
- 监听 touchstart（触摸开始）
- 监听 touchmove（触摸移动）
- 监听 touchend（触摸结束）

**滑动逻辑**
- 记录 touchstart 的 X 坐标
- 在 touchmove 中计算位移距离
- 在 touchend 中判断滑动方向和距离
  - 向左滑动超过阈值（例如 50px）：切换到下一张
  - 向右滑动超过阈值：切换到上一张
  - 未超过阈值：回弹到原位

**拖拽跟随（可选）**
- 在 touchmove 中实时更新卡片位置（跟随手指）
- 创建更流畅的触摸体验
- touchend 时根据滑动速度和距离决定是否切换

### 行动号召按钮

**点击行为**
- 跳转到工具页面或打开模态框
- 传递当前选中的工具类别参数
- 可选：记录用户点击数据（分析用途）

**悬浮效果**
- 背景色变化
- 轻微放大（transform: scale(1.05)）
- 阴影增强

---

## 🔧 技术实现要点

### CSS 3D 变换

**透视设置**
- 在父容器上设置 perspective 属性（例如 1000px）
- 创建 3D 空间，让子元素的 translateZ 生效

**卡片变换**
- 使用 transform 组合多个变换：
  - translateX：控制水平位移
  - translateZ：控制深度（前后位移）
  - scale：控制缩放大小
- 变换顺序很重要：通常是 translateX → translateZ → scale

**层级控制**
- 使用 z-index 控制堆叠顺序
- 中央卡片 z-index 最高，越远的卡片 z-index 越低
- 注意：z-index 只在同一层叠上下文中生效

### JavaScript 状态管理

**核心变量**
- currentIndex：当前中央卡片的索引
- currentTool：当前选中的工具类别
- cardsData：存储所有工具的卡片数据
- isAnimating：动画进行中的标志（防止重复触发）

**计算函数**
- calculateCardPosition(cardIndex, currentIndex)：根据卡片索引和当前索引，计算卡片应该的位置、缩放、亮度
- updateCardsPosition()：遍历所有卡片，调用 calculateCardPosition，更新 DOM 样式
- switchCard(direction)：切换卡片的主函数，direction 为 1（下一张）或 -1（上一张）

**事件处理**
- 滚轮事件节流：使用 setTimeout 或专门的节流函数
- 防止动画期间重复触发：检查 isAnimating 标志
- 清理事件监听器：模块卸载时移除监听器（如果是 SPA）

### 性能优化策略

**GPU 加速**
- 使用 transform 和 opacity 属性（会触发合成层）
- 避免使用 left、top、width、height（会触发重排）
- 添加 will-change: transform 提示浏览器优化

**节流和防抖**
- 滚轮事件节流：150-200ms 处理一次
- 窗口 resize 事件防抖：300ms 后重新计算布局
- 避免在动画过程中执行复杂计算

**图片优化**
- 使用适当尺寸的图片（不要过大）
- 推荐格式：WebP（有 fallback）
- 懒加载：只加载可见和即将可见的卡片图片

**代码优化**
- 缓存 DOM 查询结果
- 避免在循环中查询 DOM
- 使用 requestAnimationFrame 进行动画相关操作

---

## 📱 响应式适配细节

### 断点策略

**断点 1：992px（桌面/平板分界）**
- 大于 992px：显示 5 张卡片
- 小于 992px：显示 3 张卡片
- 调整：卡片尺寸、间距、透视距离

**断点 2：768px（平板/移动分界）**
- 大于 768px：保持卡片轮播
- 小于 768px：
  - 仅显示 1 张卡片
  - 显示左右箭头按钮
  - 启用触摸滑动
  - 工具标签可能改为横向滚动

**断点 3：479px（小屏手机）**
- 进一步缩小文字大小
- 增大按钮尺寸（便于点击）
- 减小间距和内边距

### 触摸屏优化

**触摸目标尺寸**
- 所有可点击元素最小尺寸：48x48px（Apple HIG 标准）
- 工具标签按钮：增大内边距
- 箭头按钮：足够大，容易点击

**禁用悬浮效果**
- 使用媒体查询：@media (hover: none)
- 在触摸设备上禁用 hover 样式
- 改用 active 状态或点击反馈

**滚动行为**
- 禁用页面纵向滚动时触发卡片切换（避免冲突）
- 或者只在卡片区域内监听滚轮事件
- 移动端优先使用触摸滑动而非滚轮

---

## 🎬 动画时序设计

### 初始加载动画（可选）

**淡入效果**
- 模块首次进入视口时触发
- 标题、标签、卡片依次淡入
- 延迟时间：标题 0s，标签 0.2s，卡片 0.4s

**卡片堆叠动画**
- 卡片从中心展开到初始位置
- 创建"翻牌"或"散开"的效果
- 持续时间：0.8-1.0 秒

### 切换动画流程

**时间线**
1. **0ms**：用户滚动滚轮，事件触发
2. **0-50ms**：JavaScript 计算新位置，更新 CSS 变量或样式
3. **50-650ms**：CSS transition 执行动画（600ms）
4. **650ms**：动画结束，更新 z-index（避免动画期间闪烁）

**动画细节**
- 所有卡片同时开始动画
- 使用统一的 easing 函数（保持一致性）
- 亮度变化与位移、缩放同步

### 滚动交互动画

**连续滚动处理**
- 用户快速连续滚动时，排队处理切换请求
- 或者：直接跳转到目标索引，跳过中间帧
- 避免动画堆积导致延迟

**边界反馈**
- 到达第一张或最后一张时（非循环模式）
- 播放轻微的"抖动"或"弹簧"效果
- 视觉提示用户已到达边界

---

## 📦 模块集成步骤

### 文件创建
1. 创建目录：sections/tools-showcase/
2. 创建文件：sections/tools-showcase/tools-showcase.html
3. 文件结构：<style> 标签 + <section> HTML + <script> 标签

### 构建配置更新
1. 打开：tools/build.config.json
2. 在 sections 数组中添加："tools-showcase"
3. 建议位置：在 "gallery" 和 "stats" 之间
4. 保存配置文件

### 资源文件准备
1. 准备图片资源（每个工具 5-7 张示例图）
2. 图片命名规范：
   - tool-image-gen-1.jpg、tool-image-gen-2.jpg...
   - tool-video-gen-1.jpg、tool-video-gen-2.jpg...
   - tool-timeline-1.jpg、tool-timeline-2.jpg...
   - tool-avatar-1.jpg、tool-avatar-2.jpg...
3. 存放路径：assets/images/
4. 图片优化：压缩到合理大小（每张 200-500KB）

### 全局样式检查
1. 检查 global/global.css 中的 CSS 变量
2. 确保有足够的颜色、间距变量可用
3. 如需新变量，添加到 :root 中

### 构建和测试
1. 运行构建脚本：python3 tools/build.py
2. 启动开发服务器：./start-dev.sh
3. 在浏览器中测试：http://localhost:8000

---

## ✅ 测试清单

### 功能测试
- [ ] 鼠标滚轮向下切换到下一张卡片
- [ ] 鼠标滚轮向上切换到上一张卡片
- [ ] 循环轮播正常工作（首尾相连）
- [ ] 4 个工具标签都能正常切换
- [ ] 点击标签后显示对应工具的卡片
- [ ] RUN GENERATOR 按钮点击有响应
- [ ] 移动端触摸滑动切换正常

### 视觉测试
- [ ] 中央卡片明显放大
- [ ] 左右卡片按比例缩小
- [ ] 卡片正确堆叠（类似扑克牌）
- [ ] 远处的卡片明显变暗
- [ ] 切换动画流畅自然
- [ ] 无卡顿或闪烁

### 响应式测试
- [ ] 桌面端（≥992px）显示 5 张卡片
- [ ] 平板端（768-991px）显示 3 张卡片
- [ ] 移动端（<768px）显示 1 张卡片
- [ ] 移动端左右箭头按钮正常显示
- [ ] 工具标签在移动端可正常点击
- [ ] 触摸滑动流畅，无延迟

### 性能测试
- [ ] 动画帧率稳定在 60fps
- [ ] 快速滚动不会卡顿
- [ ] 图片加载不会阻塞交互
- [ ] 内存使用合理（无泄漏）
- [ ] 移动端性能良好

### 兼容性测试
- [ ] Chrome 最新版
- [ ] Firefox 最新版
- [ ] Safari 最新版（桌面和移动）
- [ ] Edge 最新版
- [ ] 移动端浏览器（iOS Safari、Chrome Mobile）

### 可访问性测试
- [ ] 键盘可以聚焦到标签按钮
- [ ] 键盘 Tab 导航顺序合理
- [ ] 按钮有清晰的焦点样式
- [ ] 图片有合适的 alt 属性
- [ ] 色彩对比度符合 WCAG 标准

---

## 🔄 后续优化方向

### 第一阶段优化（短期）
- 添加键盘方向键支持（←→ 键切换卡片）
- 添加进度指示器（dots）显示当前位置
- 优化移动端的拖拽跟随效果
- 添加预加载（提前加载相邻卡片图片）

### 第二阶段优化（中期）
- 支持视频内容（替换图片）
- 视频悬浮自动播放
- 添加自动播放模式（可选，3-5 秒切换一次）
- 添加暂停/播放控制按钮

### 第三阶段优化（长期）
- 动态数据源（从 API 获取卡片数据）
- 用户生成内容展示（UGC）
- 点击卡片查看详情（模态框或新页面）
- 社交分享功能（分享作品到社交媒体）

### 性能优化方向
- 虚拟滚动（如果卡片数量很多）
- 图片懒加载优化
- 使用 Intersection Observer 监听可见性
- 考虑使用 Web Workers 处理复杂计算

---

## 🎨 设计参考

### 类似案例
- Apple AirPods Pro 产品页（卡片滚动效果）
- Netflix 内容轮播（深度堆叠）
- Spotify 专辑展示（3D 旋转）

### 设计原则
- **简洁优先**：避免过度装饰
- **功能清晰**：用户一眼就知道如何操作
- **性能优先**：流畅度比花哨更重要
- **品牌一致**：符合整体宇宙/太空主题

### 色彩建议
- 背景：深色（接近黑色，#0a0e27 或类似）
- 卡片边框：渐变色（宇宙主题：紫色到粉色）
- 激活标签：主题色或渐变背景
- 按钮：主题色背景 + 白色文字

---

## 📝 注意事项

### 开发注意事项
1. **模块独立性**：所有 CSS 和 JS 都封装在模块文件内，使用 IIFE 包裹避免全局污染
2. **命名空间**：CSS 类名使用 .tools-showcase- 前缀避免冲突
3. **性能优先**：使用 transform 代替其他定位属性
4. **移动优先**：先实现移动端，再增强桌面端
5. **渐进增强**：基础功能在所有浏览器都能用，高级特效在现代浏览器增强

### 已知限制
1. 鼠标滚轮事件在不同浏览器和操作系统上可能有差异
2. 3D 变换在旧版 Safari 可能有兼容性问题
3. 触摸滑动在某些 Android 浏览器可能不流畅

### 替代方案
- 如果 3D 效果性能不佳，降级为 2D 平面滚动
- 如果滚轮交互有问题，添加左右箭头按钮作为 fallback
- 如果图片过多导致加载慢，使用分页或懒加载

---

## 📚 参考资源

### CSS 技术
- CSS 3D Transforms
- CSS Transitions 和 Animations
- CSS Grid 和 Flexbox 布局
- CSS 变量（Custom Properties）

### JavaScript 技术
- Wheel Event API
- Touch Events API
- Intersection Observer API（用于懒加载）
- RequestAnimationFrame（用于流畅动画）

### 性能优化
- GPU 加速最佳实践
- 防抖和节流函数实现
- 图片优化技术（WebP、懒加载）
- 浏览器渲染机制（重排、重绘、合成）

---

## 总结

本文档详细描述了 tools-showcase 模块的完整技术实现方案，包括：

✅ **功能需求**：4 个工具标签 + 3D 卡片轮播 + 鼠标滚轮交互
✅ **视觉设计**：深度层叠效果 + 中央放大 + 侧边堆叠
✅ **交互逻辑**：滚轮切换 + 标签切换 + 触摸支持
✅ **响应式策略**：桌面 5 张、平板 3 张、移动 1 张
✅ **性能优化**：GPU 加速 + 节流防抖 + 懒加载
✅ **测试清单**：功能、视觉、性能、兼容性全覆盖

该方案充分考虑了项目的宇宙主题、简洁风格和性能要求，后续只需按照描述进行代码实现即可。
