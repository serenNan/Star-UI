<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="TreClip - AI short-form video created like art">
  <title>TreClip - AI Video Creation Platform</title>

  <!-- 预加载CSS文件,确保样式优先加载,避免闪烁 -->
  <link rel="preload" href="css/normalize.css" as="style">
  <link rel="preload" href="css/webflow.css" as="style">
  <link rel="preload" href="css/treclip.css" as="style">
  <link rel="preload" href="global/global.css" as="style">

  <!-- CSS Files -->
  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/webflow.css">
  <link rel="stylesheet" href="css/treclip.css">
  <link rel="stylesheet" href="global/global.css">

  <!-- Google Fonts - 添加 display=block 防止字体加载闪烁 -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=block"
    rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=block" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&display=block"
    rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Sora:wght@300;400;500;600;700;800&display=block" rel="stylesheet">

  <!-- Lenis Smooth Scroll -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lenis@1.2.3/dist/lenis.css">
  <script src="https://cdn.jsdelivr.net/npm/lenis@1.2.3/dist/lenis.min.js"></script>

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="favicon.png">

  <!-- 隐藏滚动条样式 -->
  <style>
    /* 隐藏所有浏览器的滚动条 */
    html {
      overflow-x: hidden;
      scrollbar-width: none;
      /* Firefox */
      -ms-overflow-style: none;
      /* IE and Edge */
    }

    body {
      overflow-x: hidden;
      scrollbar-width: none;
      /* Firefox */
      -ms-overflow-style: none;
      /* IE and Edge */
    }

    body.page-index {
      font-family: 'Sora', sans-serif;
    }

    body.page-index .banner,
    body.page-index .banner * {
      font-family: var(--font-primary);
    }

    /* 隐藏 Webkit 浏览器的滚动条 (Chrome, Safari, Opera) */
    html::-webkit-scrollbar,
    body::-webkit-scrollbar {
      display: none;
      width: 0;
      height: 0;
    }

    /* ===== Launch Overlay ===== */
    #launch-overlay {
      position: fixed;
      inset: 0;
      background: #050505;
      z-index: 9999;
      opacity: 0;
      pointer-events: none;
      visibility: hidden;  /* 防止闪动 */
      transition: opacity 0.6s ease, visibility 0s linear 0.6s;  /* 加快淡入速度: 1.0s → 0.6s */
      will-change: opacity, transform;  /* 添加 transform,强制 GPU 加速 */
      transform: translateZ(0);  /* 强制创建独立合成层 */
    }

    #launch-overlay.is-visible {
      opacity: 1;
      pointer-events: auto;
      visibility: visible;
      transition: opacity 0.6s ease, visibility 0s linear 0s;  /* 立即显示 visibility */
    }

    #launch-overlay.is-exiting {
      opacity: 0;
      visibility: visible;  /* 淡出时保持可见 */
      transition: opacity 0.8s ease, visibility 0s linear 0.8s;  /* 加快淡出: 1.0s → 0.8s */
    }

    .launch-shell {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: min(550px, 90vw);
      max-width: none;
      padding: 0;
      opacity: 0;  /* 初始隐藏内容,避免按钮提前可见 */
      transition: opacity 0.4s ease 0.2s;  /* 延迟 0.2s 后淡入,持续 0.4s */
    }

    #launch-overlay.is-visible .launch-shell {
      opacity: 1;  /* overlay 显示后,shell 才淡入 */
    }

    .launch-input {
      position: relative;
      width: 100%;
      height: 100%;
      min-height: 48px;
      border-radius: 25px;
      border: none !important;  /* 与 Banner 搜索框一致 */
      background: rgba(0, 0, 0, 0.5);  /* 与 Banner 搜索框一致 */
      box-shadow: none;
      backdrop-filter: blur(10px);
      transform: translateZ(0);  /* 为 backdrop-filter 创建独立合成层 */
      will-change: transform;  /* 性能优化 */
    }

    .launch-text {
      display: block;
      min-height: 1.2em;
      padding: 10px 140px 10px 20px;
      white-space: pre-wrap;  /* 与 Banner 搜索框一致 */
      overflow: hidden;
      color: #f5f5f5;
      font-size: 0.7rem;
      font-family: 'Sora', sans-serif;  /* 显式指定字体,避免继承链延迟 */
      letter-spacing: 0;  /* 与 Banner 搜索框一致 */
      line-height: 1.4;
      word-break: break-word;
      overflow-wrap: break-word;  /* 与 Banner 搜索框一致 */
      text-align: left;
    }

    .launch-btn {
      position: absolute;
      top: 50%;
      right: 6px;
      transform: translateY(-50%);
      border: none;
      border-radius: 20px;
      padding: 8px 16px;
      background: #ffffff;
      color: #111;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: transform 0.4s ease, box-shadow 0.4s ease;
      box-shadow: none;
      white-space: nowrap;
    }

    .launch-btn:disabled {
      opacity: 0.8;
      cursor: wait;
    }

    .launch-btn:not(:disabled):hover {
      transform: translateY(calc(-50% - 2px));
      box-shadow: 0 8px 18px rgba(255, 255, 255, 0.25);
    }

    .launch-btn:not(:disabled):active,
    .launch-btn.is-pressed {
      transform: translateY(calc(-50% + 1px)) scale(0.96);
      box-shadow:
        0 0 0 4px rgba(255, 255, 255, 0.25),
        inset 0 4px 10px rgba(0, 0, 0, 0.25);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    body.launch-block-scroll {
      overflow: hidden;
    }

    @media (max-width: 600px) {
      .launch-text {
        font-size: 0.7rem;
        padding-right: 120px;
      }

      .launch-btn {
        font-size: 0.85rem;
        padding-inline: 1rem;
      }
    }
  </style>

  <script>
    (function () {
      const STORAGE_KEY = 'treclipLaunchSeen';
      const typedText = 'ultra-realistic close-up of an astronaut in a detailed white space suit, standing in the darkness of outer space.';

      const path = window.location.pathname || '';
      const isIndex = /(?:^|\/)index\.html?$/i.test(path) || path === '/' || path === '';
      if (!isIndex) {
        return;
      }

      let storageEnabled = true;
      try {
        const testKey = '__treclip_test__';
        window.sessionStorage.setItem(testKey, '1');
        window.sessionStorage.removeItem(testKey);
      } catch (err) {
        storageEnabled = false;
      }

      // 移除 sessionStorage 检查,使加载动画每次刷新都显示
      // if (storageEnabled && window.sessionStorage.getItem(STORAGE_KEY)) {
      //   return;
      // }

      const overlayTemplate = `
        <div class="launch-shell">
          <div class="launch-input" role="status" aria-live="polite">
            <span class="launch-text" data-launch-text></span>
            <button class="launch-btn" type="button" data-launch-btn>Run Engine</button>
          </div>
        </div>`;

      const overlay = document.createElement('div');
      overlay.id = 'launch-overlay';
      overlay.setAttribute('aria-hidden', 'true');
      overlay.innerHTML = overlayTemplate;
      const shell = overlay.querySelector('.launch-shell');

      const ensureOverlayVisible = () => {
        overlay.setAttribute('aria-hidden', 'false');
        if (!overlay.classList.contains('is-visible')) {
          overlay.classList.add('is-visible');
        }
      };

      const attachOverlay = () => {
        if (!document.body || overlay.parentNode) {
          return;
        }
        document.body.appendChild(overlay);
        document.body.classList.add('launch-block-scroll');
        ensureOverlayVisible();
      };

      if (document.body) {
        attachOverlay();
      } else {
        document.addEventListener('DOMContentLoaded', attachOverlay, { once: true });
        const tryAttach = () => {
          if (!overlay.parentNode) {
            attachOverlay();
            if (!overlay.parentNode) {
              requestAnimationFrame(tryAttach);
            }
          }
        };
        requestAnimationFrame(tryAttach);
      }

      const textNode = overlay.querySelector('[data-launch-text]');
      const runBtn = overlay.querySelector('[data-launch-btn]');
      let index = 0;
      let typingTimer = null;
      let isClosing = false;
      let heroTarget = null;
      let heroObserver = null;
      let pressTimer = null;
      const heroSelector = '#hero-search-box';
      const HERO_TIMEOUT = 3600; // ≈3.6s 等待 hero 渲染完成
      const FONT_TIMEOUT = 1500;

      const syncShellPosition = () => {
        if (!shell || !heroTarget) return;
        const rect = heroTarget.getBoundingClientRect();
        shell.style.top = `${rect.top}px`;
        shell.style.left = `${rect.left}px`;
        shell.style.width = `${rect.width}px`;
        shell.style.height = `${rect.height}px`;
        shell.style.transform = 'none';
      };

      const handleResize = () => syncShellPosition();

      const registerHeroTarget = (target) => {
        heroTarget = target;
        syncShellPosition();
        window.addEventListener('resize', handleResize);
        if (typeof ResizeObserver !== 'undefined') {
          heroObserver = new ResizeObserver(syncShellPosition);
          heroObserver.observe(heroTarget);
        }
      };

      const waitForHeroTarget = (timeout = HERO_TIMEOUT) => new Promise((resolve) => {
        const start = performance.now();

        const attempt = () => {
          const candidate = document.querySelector(heroSelector);
          if (candidate) {
            const rect = candidate.getBoundingClientRect();
            if (rect.width > 0 && rect.height > 0) {
              registerHeroTarget(candidate);
              resolve(true);
              return;
            }
          }

          if (performance.now() - start >= timeout) {
            resolve(false);
            return;
          }

          requestAnimationFrame(attempt);
        };

        attempt();
      });

      const waitForFonts = (timeout = FONT_TIMEOUT) => {
        if (!document.fonts || typeof document.fonts.ready?.then !== 'function') {
          return Promise.resolve(true);
        }

        return Promise.race([
          document.fonts.ready.then(() => true).catch(() => false),
          new Promise((resolve) => setTimeout(() => resolve(false), timeout)),
        ]);
      };

      const markSeen = () => {
        // 移除 sessionStorage 记录功能,允许每次刷新都显示
        // if (storageEnabled) {
        //   window.sessionStorage.setItem(STORAGE_KEY, '1');
        // }
      };

      const finishLaunch = () => {
        if (isClosing) return;
        isClosing = true;
        markSeen();
        if (pressTimer) {
          clearTimeout(pressTimer);
          pressTimer = null;
        }
        if (typingTimer) {
          clearTimeout(typingTimer);
        }
        if (runBtn) {
          runBtn.disabled = true;
        }
        overlay.classList.add('is-exiting');
        setTimeout(() => {
          window.removeEventListener('resize', handleResize);
          if (heroObserver) {
            heroObserver.disconnect();
          }
          overlay.remove();
          document.body?.classList.remove('launch-block-scroll');
        }, 1000);  // 加快关闭: 1500ms → 1000ms
      };

      const typeNext = () => {
        if (!textNode) return;
        if (index < typedText.length) {
          textNode.textContent += typedText.charAt(index);
          index += 1;
          const jitter = 8 + Math.random() * 20;  // 进一步加快打字速度: 8-28ms (平均 18ms)
          typingTimer = window.setTimeout(typeNext, jitter);
        } else {
          window.setTimeout(() => triggerFinishPress(true), 800);  // 再次减少等待时间: 1000ms → 800ms
        }
      };

      const triggerFinishPress = (withDelay = true) => {
        if (isClosing || pressTimer) return;
        if (runBtn) {
          runBtn.classList.add('is-pressed');
        }
        const delay = withDelay ? 400 : 0;  // 优化按钮反馈: 500ms → 400ms
        pressTimer = window.setTimeout(() => {
          if (runBtn) {
            runBtn.classList.remove('is-pressed');
          }
          pressTimer = null;
          finishLaunch();
        }, delay);
      };

      if (runBtn) {
        runBtn.addEventListener('click', () => triggerFinishPress(true));
      }

      overlay.addEventListener('keydown', (event) => {
        if (event.key === 'Enter') {
          triggerFinishPress(true);
        }
      });

      const startSequence = () => {
        if (!overlay.parentNode) {
          requestAnimationFrame(startSequence);
          return;
        }

        // ✨ 关键优化: 在显示前完成所有初始化
        // 1. 预同步位置 (在不可见时完成)
        syncShellPosition();

        // 2. 预填充第一个字符,避免空白期闪烁
        if (textNode && typedText.length > 0) {
          textNode.textContent = typedText.charAt(0);
          index = 1;  // 从第二个字符开始打字
        }

        // 3. 确保 overlay 已可见,避免页面内容先显示
        ensureOverlayVisible();

        // 4. 强制浏览器重排,确保所有样式已应用
        void overlay.offsetHeight;
        void shell.offsetHeight;

        // 5. 在下一帧启动打字动画 (等待 shell 淡入完成)
        requestAnimationFrame(() => {
          typingTimer = window.setTimeout(typeNext, 650);
        });
      };

      const initOverlay = () => {
        ensureOverlayVisible();
        waitForHeroTarget();
        waitForFonts().finally(() => {
          startSequence();
        });
      };

      if (overlay.parentNode) {
        ensureOverlayVisible();
        initOverlay();
      } else {
        const startWhenAttached = () => {
          if (!overlay.parentNode) {
            requestAnimationFrame(startWhenAttached);
            return;
          }
          ensureOverlayVisible();
          initOverlay();
        };
        startWhenAttached();
      }
    })();
  </script>
</head>
