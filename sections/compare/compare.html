<!-- ===================================
     Compare Module
     扑克牌堆叠效果 - 固定 1.5 倍放大状态
     =================================== -->

<style>
/* ===== 模块容器样式 ===== */
.tools-showcase {
  position: relative;
  padding: 120px 0;
  background: var(--color-bg);
  overflow: hidden;
}

/* ===== 标题区域 ===== */
.tools-showcase__header {
  text-align: center;
  margin-bottom: 40px;
}

.tools-showcase__title {
  font-size: 2.625rem;
  font-weight: 700;
  line-height: 1.2;
  margin-bottom: 0;
  color: #FFFFFF;
}

.tools-showcase__subtitle {
  font-size: 1.2rem;
  color: var(--color-text-secondary);
  max-width: 600px;
  margin: 0 auto 16px;
}

/* ===== 工具标签栏 ===== */
.tools-showcase__tabs {
  display: flex;
  justify-content: center;
  gap: 34px;
  margin-bottom: 80px;
  flex-wrap: wrap;
}

.tools-showcase__tab {
  padding: 20px 0;
  width: 230px;
  background: rgba(255, 255, 255, 0.1);
  border: none;
  border-radius: 50px;
  color: #FFFFFF;
  font-size: 1.25rem;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.3s ease;
  white-space: nowrap;
  text-align: center;
}

.tools-showcase__tab:hover {
  background: rgba(255, 255, 255, 0.18);
  color: #FFFFFF;
}

.tools-showcase__tab--active {
  background: white;
  color: black;
  border-color: transparent;
}

.tools-showcase__tab--active:hover {
  background: rgba(255, 255, 255, 0.95);
  color: black;
}

/* ===== 扑克牌堆叠容器 ===== */
.tools-showcase__carousel-wrapper {
  position: relative;
  width: 100%;
  max-width: 1200px;
  margin: 0 auto 60px;
  padding: 0 20px;
  transition: opacity 0.3s ease;
}

.tools-showcase__carousel {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 2rem;
  min-height: 500px;
  position: relative;
}

/* ===== JS 控制的移动端保护样式（双保险）===== */
.tools-showcase--mobile .tools-showcase__side {
  display: none !important;
  visibility: hidden !important;
  opacity: 0 !important;
  pointer-events: none !important;
  transform: none !important;
}

.tools-showcase--mobile .tools-showcase__carousel-wrapper {
  padding: var(--spacing-xl) 0;
  max-width: 480px;
  margin: 0 auto 40px;
  width: 100%;
}

.tools-showcase--mobile .tools-showcase__carousel {
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 0;
  min-height: auto;
  padding: var(--spacing-xl) var(--spacing-md);
}

.tools-showcase--mobile .tools-showcase__center {
  width: 100%;
  justify-content: center;
  align-items: center;
}

.tools-showcase--mobile .tools-showcase__card--main {
  width: min(90vw, 400px);
  max-width: 400px;
  min-height: 260px;
  margin: 0 auto;
  aspect-ratio: 16 / 9;
  height: auto;
  display: block;
}

/* ===== 左右两侧堆叠容器 - 固定推开 100px ===== */
.tools-showcase__side {
  position: relative;
  z-index: 1;
}

.tools-showcase__side.left {
  margin-right: -3rem;
  display: grid;
  grid-template-columns: 1fr;
  gap: 2rem;
  align-content: center;
  position: relative;
  /* 固定推开 100px */
  transform: translateX(-100px);
}

.tools-showcase__side.right {
  margin-left: 0.625rem;
  display: flex;
  align-items: flex-start;
  align-self: flex-start;
  margin-top: -1.25rem;
  /* 固定推开 100px */
  transform: translateX(100px);
}

/* ===== 中央容器 ===== */
.tools-showcase__center {
  position: relative;
  display: flex;
  align-items: center;
  gap: 1rem;
  z-index: 1;
}

/* ===== 卡片样式 ===== */
.tools-showcase__card {
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
  background: #1a1a1a;
}

.tools-showcase__card-image {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
  user-select: none;
}

/* ===== 对比容器样式 ===== */
.compare-container {
  position: relative;
  width: 100%;
  height: 100%;
  overflow: hidden;
  cursor: grab; /* 可抓取光标 */
}

.compare-container:active {
  cursor: grabbing; /* 拖动中光标 */
}

/* 背景图 (After) */
.compare-image--after {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  user-select: none;
  pointer-events: none;
}

/* 前景图 (Before) - 通过 clip-path 裁剪 */
.compare-image--before {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  user-select: none;
  pointer-events: none;
  /* 默认显示左侧 50% */
  clip-path: inset(0 50% 0 0);
  transition: clip-path 0.05s ease-out;
}

/* ===== 对比滑块样式 ===== */
.compare-slider {
  position: absolute;
  top: 0;
  left: 50%; /* 默认位置 50% */
  width: 1px;
  height: 100%;
  background: rgba(255, 255, 255, 0.3);
  transform: translateX(-50%);
  pointer-events: none;
  z-index: 10;
  transition: left 0.05s ease-out;
}

/* 垂直线条 */
.compare-slider__line {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(255, 255, 255, 0.35);
  box-shadow: 0 0 4px rgba(0, 0, 0, 0.15);
}

/* 箭头容器 - 放在偏上方 */
.compare-slider__handle {
  position: absolute;
  top: 30%; /* 偏上方位置 */
  left: 50%;
  transform: translate(-50%, -50%);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  pointer-events: none;
  z-index: 1;
}

/* 左右箭头 - 无背景 */
.compare-slider__arrow {
  color: white;
  font-size: 14px;
  font-weight: normal;
  text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
  flex-shrink: 0;
}

/* 左箭头 */
.compare-slider__arrow--left {
  /* 无需额外样式 */
}

/* 右箭头 */
.compare-slider__arrow--right {
  /* 无需额外样式 */
}

/* 小卡片（左右两侧）*/
.tools-showcase__card--small {
  opacity: 0.6;
  transition: opacity 0.3s ease;
}

/* 左侧第一个卡片 - 横向长方形（左上角）*/
.tools-showcase__side.left .tools-showcase__card--small:nth-child(1) {
  width: 260px;
  height: 160px;
  position: relative;
  top: -8vh;
  left: -20px;
}

/* 左侧第二个卡片 - 正方形（左下角）*/
.tools-showcase__side.left .tools-showcase__card--small:nth-child(2) {
  width: 215px;
  height: 215px;
  position: relative;
  top: 70px;
  left: 5px;
}

/* 右侧卡片 - 竖向长方形 */
.tools-showcase__side.right .tools-showcase__card--small {
  width: 180px;
  height: 280px;
  position: relative;
  top: -1.25rem;
  left: 10px;
}

/* 主卡片容器 - 固定 1.5 倍缩放 */
.tools-showcase__card--main {
  width: 550px;
  height: 300px;
  border: none;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.7);
  z-index: 1;
  position: relative;
  overflow: hidden;
  /* 固定 1.5 倍缩放 */
  transform: scale(1.5);
  transform-origin: center center;
}

/* 主卡片图片 */
.tools-showcase__card--main .tools-showcase__card-image {
  transition: opacity 0.4s ease;
  opacity: 1;
}

/* 图片切换时的模糊效果 */
.tools-showcase__card--main.switching {
  transition: filter 0.3s ease;
}

.tools-showcase__card--main.switching .tools-showcase__card-image {
  filter: blur(8px);
  opacity: 0.5;
}

/* 小卡片淡入淡出过渡 */
.tools-showcase__card--small .tools-showcase__card-image {
  transition: opacity 0.5s ease;
}

/* ===== 响应式：平板 ===== */
@media (max-width: 991px) {
  .tools-showcase {
    padding: 80px 0;
  }

  .tools-showcase__title {
    font-size: 2.5rem;
  }

  .tools-showcase__tabs {
    margin-bottom: 60px;
  }

  .tools-showcase__tab {
    padding: 12px 24px;
    font-size: 0.875rem;
  }

  .tools-showcase__carousel {
    gap: 1.5rem;
  }

  /* 平板端缩小主卡片容器尺寸 */
  .tools-showcase__card--main {
    width: 500px;
    height: 350px;
  }

  /* 左右小卡片也相应缩小 */
  .tools-showcase__card--small {
    width: 160px;
    height: 200px;
  }

  /* 调整负边距以适应较小的卡片 */
  .tools-showcase__side.left {
    margin-right: -120px;
  }

  .tools-showcase__side.right {
    margin-left: -120px;
  }

  /* 隐藏左右第二张小卡片，仅显示最近的一张 */
  .tools-showcase__side .tools-showcase__card:first-child {
    display: none;
  }
}

/* ===== 响应式：移动端 ===== */
@media (max-width: 767px) {
  .tools-showcase {
    padding: 60px 0;
    overflow-x: hidden;
    overflow-y: visible;
  }

  /* 标题区域 - 居中对齐 */
  .tools-showcase__header {
    text-align: center;
    margin-bottom: 30px;
    padding: 0 var(--spacing-md);
  }

  .tools-showcase__title {
    font-size: 2rem;
    line-height: 1.2;
  }

  .tools-showcase__subtitle {
    font-size: 1rem;
    margin-bottom: 12px;
  }

  /* 标签栏 - 居中 + 增大触摸区域 */
  .tools-showcase__tabs {
    gap: 8px;
    margin-bottom: 40px;
    padding: 0 var(--spacing-sm);
    justify-content: center;
  }

  .tools-showcase__tab {
    padding: 12px 20px;
    min-height: 44px;
    font-size: 0.8125rem;
    width: auto;
    flex: 0 0 auto;
  }

  /* 标签栏触摸反馈 */
  .tools-showcase__tab:active {
    transform: scale(0.95);
    transition: transform 0.1s ease;
  }

  /* 强制隐藏左右堆叠，仅显示中央卡片 */
  .tools-showcase__side {
    display: none !important;
    visibility: hidden !important;
    opacity: 0 !important;
    pointer-events: none !important;
    position: absolute !important;
    width: 0 !important;
    height: 0 !important;
    overflow: hidden !important;
  }

  .tools-showcase__side.left,
  .tools-showcase__side.right {
    display: none !important;
  }

  /* 轮播容器 - 完美居中 + 留出缩放空间 */
  .tools-showcase__carousel-wrapper {
    padding: var(--spacing-xl) 0;
    overflow: visible;
    width: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .tools-showcase__carousel {
    gap: 0;
    min-height: 500px;
    display: flex !important;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: var(--spacing-xl) var(--spacing-md);
    width: 100%;
    max-width: 100%;
    margin: 0 auto;
  }

  /* 中央容器 - 完美居中 */
  .tools-showcase__center {
    display: flex !important;
    justify-content: center;
    align-items: center;
    width: 100%;
    max-width: 100%;
    margin: 0 !important;
    position: relative;
  }

  /* 主卡片 - 弹性尺寸 + 完美居中 */
  .tools-showcase__card--main {
    width: 90%;
    max-width: 400px;
    height: auto;
    min-height: 300px;
    aspect-ratio: 16 / 9;
    margin: 0 !important;
    display: block;
    transform-origin: center center;
    position: relative;
  }

  /* 主卡片图片 - 保持宽高比 */
  .tools-showcase__card--main .tools-showcase__card-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  /* 移动端 - 滑块已隐藏,无需额外样式 */
}

/* ===== 小屏手机优化 ===== */
@media (max-width: 479px) {
  /* 标题进一步缩小 */
  .tools-showcase__title {
    font-size: 1.75rem;
    padding: 0 var(--spacing-sm);
  }

  .tools-showcase__subtitle {
    font-size: 0.9375rem;
  }

  /* 标签栏紧凑布局 */
  .tools-showcase__tabs {
    gap: 6px;
    padding: 0 var(--spacing-xs);
  }

  .tools-showcase__tab {
    padding: 10px 16px;
    font-size: 0.75rem;
    min-width: auto;
  }

  /* 小屏手机也强制隐藏左右卡片 */
  .tools-showcase__side {
    display: none !important;
    visibility: hidden !important;
    position: absolute !important;
    width: 0 !important;
    height: 0 !important;
    overflow: hidden !important;
  }

  /* 轮播容器紧凑间距 + 留出缩放空间 */
  .tools-showcase__carousel-wrapper {
    padding: var(--spacing-lg) 0;
    width: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .tools-showcase__carousel {
    min-height: 450px;
    padding: var(--spacing-lg) var(--spacing-sm);
    display: flex !important;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    width: 100%;
    max-width: 100%;
    margin: 0 auto;
  }

  .tools-showcase__center {
    display: flex !important;
    justify-content: center;
    align-items: center;
    width: 100%;
    margin: 0 !important;
  }

  /* 主卡片进一步缩小 + 完美居中 */
  .tools-showcase__card--main {
    width: 90%;
    max-width: 320px;
    min-height: 250px;
    margin: 0 !important;
    display: block;
    transform-origin: center center;
    position: relative;
  }
}

/* ===== 禁用触摸设备的悬浮效果 ===== */
@media (hover: none) {
  /* 禁用标签按钮悬浮效果 */
  .tools-showcase__tab:hover {
    background: rgba(255, 255, 255, 0.1);
    color: #FFFFFF;
  }

  .tools-showcase__tab--active:hover {
    background: white;
    color: black;
  }

  /* 增强触摸激活状态 */
  .tools-showcase__tab:active {
    background: rgba(255, 255, 255, 0.15);
  }

  .tools-showcase__tab--active:active {
    background: rgba(255, 255, 255, 0.9);
  }
}
</style>

<!-- ===== HTML 结构 ===== -->
<section class="tools-showcase" id="compareShowcase">
  <div class="container">
    <!-- 标题区域 -->
    <div class="tools-showcase__header">
      <p class="tools-showcase__subtitle">
        COMPARE
      </p>
      <h2 class="tools-showcase__title">Where Imagination Eclipses Reality.</h2>
    </div>

    <!-- 工具标签栏 -->
    <div class="tools-showcase__tabs" id="compareTabs">
      <button class="tools-showcase__tab tools-showcase__tab--active" data-tool="image-generator">
        Image Generator
      </button>
      <button class="tools-showcase__tab" data-tool="video-generator">
        Video Generator
      </button>
      <button class="tools-showcase__tab" data-tool="timeline-editor">
        Timeline Editor
      </button>
      <button class="tools-showcase__tab" data-tool="avatar">
        Avatar
      </button>
    </div>

    <!-- 扑克牌堆叠轮播 -->
    <div class="tools-showcase__carousel-wrapper">
      <div class="tools-showcase__carousel" id="compareCarousel">
        <!-- 左侧堆叠（2张小卡片）-->
        <div class="tools-showcase__side left" id="compareLeftStack">
          <div class="tools-showcase__card tools-showcase__card--small">
            <div class="compare-container">
              <img src="" alt="" class="compare-image compare-image--after">
              <img src="" alt="" class="compare-image compare-image--before">
              <div class="compare-slider">
                <div class="compare-slider__line"></div>
                <div class="compare-slider__handle">
                  <div class="compare-slider__arrow compare-slider__arrow--left">&lt;</div>
                  <div class="compare-slider__arrow compare-slider__arrow--right">&gt;</div>
                </div>
              </div>
            </div>
          </div>
          <div class="tools-showcase__card tools-showcase__card--small">
            <div class="compare-container">
              <img src="" alt="" class="compare-image compare-image--after">
              <img src="" alt="" class="compare-image compare-image--before">
              <div class="compare-slider">
                <div class="compare-slider__line"></div>
                <div class="compare-slider__handle">
                  <div class="compare-slider__arrow compare-slider__arrow--left">&lt;</div>
                  <div class="compare-slider__arrow compare-slider__arrow--right">&gt;</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 中央大卡片 -->
        <div class="tools-showcase__center">
          <div class="tools-showcase__card tools-showcase__card--main" id="compareMainCard">
            <div class="compare-container">
              <img src="" alt="" class="compare-image compare-image--after">
              <img src="" alt="" class="compare-image compare-image--before">
              <div class="compare-slider">
                <div class="compare-slider__line"></div>
                <div class="compare-slider__handle">
                  <div class="compare-slider__arrow compare-slider__arrow--left">&lt;</div>
                  <div class="compare-slider__arrow compare-slider__arrow--right">&gt;</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 右侧堆叠（1张竖向长方形卡片）-->
        <div class="tools-showcase__side right" id="compareRightStack">
          <div class="tools-showcase__card tools-showcase__card--small">
            <div class="compare-container">
              <img src="" alt="" class="compare-image compare-image--after">
              <img src="" alt="" class="compare-image compare-image--before">
              <div class="compare-slider">
                <div class="compare-slider__line"></div>
                <div class="compare-slider__handle">
                  <div class="compare-slider__arrow compare-slider__arrow--left">&lt;</div>
                  <div class="compare-slider__arrow compare-slider__arrow--right">&gt;</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- ===== JavaScript 交互逻辑 ===== -->
<script>
(function() {
  'use strict';

  // ===== 工具数据配置 =====
  // 使用现有图片进行随机组合,展示前后对比效果
  const moduleImages = {
    card1: { before: 'sections/compare/1.png', after: 'sections/compare/2.jpg' },
    card2: { before: 'sections/compare/3.png', after: 'sections/compare/4.png' },
    card3: { before: 'sections/compare/2.jpg', after: 'sections/compare/1.png' },
    card4: { before: 'sections/compare/4.png', after: 'sections/compare/3.png' }
  };

  // 不同分类的卡片配置 (数组结构: [左上, 左下, 中央, 右侧])
  const toolsData = {
    'image-generator': [
      moduleImages.card1, // 左上: 1.png → 2.jpg
      moduleImages.card2, // 左下: 3.png → 4.png
      moduleImages.card3, // 中央: 2.jpg → 1.png
      moduleImages.card4  // 右侧: 4.png → 3.png
    ],
    'video-generator': [
      moduleImages.card2, // 左上: 3.png → 4.png
      moduleImages.card1, // 左下: 1.png → 2.jpg
      moduleImages.card4, // 中央: 4.png → 3.png
      moduleImages.card3  // 右侧: 2.jpg → 1.png
    ],
    'timeline-editor': [
      moduleImages.card3, // 左上: 2.jpg → 1.png
      moduleImages.card4, // 左下: 4.png → 3.png
      moduleImages.card1, // 中央: 1.png → 2.jpg
      moduleImages.card2  // 右侧: 3.png → 4.png
    ],
    'avatar': [
      moduleImages.card4, // 左上: 4.png → 3.png
      moduleImages.card3, // 左下: 2.jpg → 1.png
      moduleImages.card2, // 中央: 3.png → 4.png
      moduleImages.card1  // 右侧: 1.png → 2.jpg
    ]
  };

  // ===== 状态管理 =====
  let currentTool = 'image-generator';
  let isAnimating = false;
  let currentCards = toolsData[currentTool];

  // 动态检测是否为移动设备
  function isMobileDevice() {
    return window.innerWidth < 768;
  }

  // ===== DOM 元素 =====
  const showcaseSection = document.getElementById('compareShowcase');
  const carousel = showcaseSection ? showcaseSection.querySelector('#compareCarousel') : null;
  const tabs = showcaseSection ? showcaseSection.querySelectorAll('.tools-showcase__tab') : [];

  // 获取所有对比容器
  const compareContainers = showcaseSection ? showcaseSection.querySelectorAll('.compare-container') : [];

  if (!showcaseSection || !carousel || compareContainers.length < 4) {
    console.warn('[compare] 必要的 DOM 节点缺失，已跳过脚本初始化。');
    return;
  }

  const leftSide = showcaseSection.querySelector('#compareLeftStack');
  const rightSide = showcaseSection.querySelector('#compareRightStack');
  let resizeRaf = null;

  // ===== 初始化 =====
  function init() {
    updateCardsDisplay();
    updateResponsiveLayout();
    attachEventListeners();
    initCompareSliders(); // 初始化对比滑块
  }

  // ===== 更新卡片显示 =====
  function updateCardsDisplay() {
    // currentCards 数组结构: [左上, 左下, 中央, 右侧]
    // 更新所有 4 张卡片的 before/after 图片
    compareContainers.forEach((container, index) => {
      if (index < currentCards.length) {
        const imageData = currentCards[index];
        const afterImg = container.querySelector('.compare-image--after');
        const beforeImg = container.querySelector('.compare-image--before');

        if (afterImg && beforeImg && imageData) {
          afterImg.src = imageData.after;
          afterImg.alt = `After - Card ${index + 1}`;
          beforeImg.src = imageData.before;
          beforeImg.alt = `Before - Card ${index + 1}`;
        }
      }
    });
  }

  // ===== 根据屏幕宽度切换布局（JS + CSS 双保险）=====
  function updateResponsiveLayout() {
    if (!showcaseSection) return;

    const mobile = isMobileDevice();
    showcaseSection.classList.toggle('tools-showcase--mobile', mobile);

    if (leftSide) {
      leftSide.hidden = mobile;
      if (mobile) {
        leftSide.setAttribute('aria-hidden', 'true');
      } else {
        leftSide.removeAttribute('aria-hidden');
      }
    }

    if (rightSide) {
      rightSide.hidden = mobile;
      if (mobile) {
        rightSide.setAttribute('aria-hidden', 'true');
      } else {
        rightSide.removeAttribute('aria-hidden');
      }
    }
  }


  // ===== 监听窗口尺寸变化 =====
  function handleResize() {
    if (resizeRaf) return;

    resizeRaf = requestAnimationFrame(() => {
      resizeRaf = null;
      updateResponsiveLayout();
    });
  }

  // ===== 对比滑块交互逻辑 =====
  function initCompareSliders() {
    // 为每张卡片设置不同的初始分割位置
    // [左上, 左下, 中央, 右侧]
    const initialPositions = [65, 45, 37, 58]; // 中央卡片 37%,其他卡片随机分布

    compareContainers.forEach((container, index) => {
      const slider = container.querySelector('.compare-slider');
      const beforeImg = container.querySelector('.compare-image--before');

      if (!slider || !beforeImg) return;

      // 获取当前卡片的初始位置
      const defaultPosition = initialPositions[index] || 50;
      let isDragging = false;

      // 更新滑块位置和图片裁剪
      function updateSliderPosition(percentage) {
        // 限制在 0-100% 之间
        percentage = Math.max(0, Math.min(100, percentage));

        // 更新滑块位置
        slider.style.left = `${percentage}%`;

        // 更新前景图裁剪 (clip-path: inset(top right bottom left))
        // 右侧裁剪 = (100 - percentage)%
        beforeImg.style.clipPath = `inset(0 ${100 - percentage}% 0 0)`;
      }

      // 从鼠标/触摸事件计算百分比
      function getPercentageFromEvent(e) {
        const rect = container.getBoundingClientRect();
        const clientX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
        const x = clientX - rect.left;
        return (x / rect.width) * 100;
      }

      // 开始拖动
      function startDrag(e) {
        isDragging = true;
        container.style.cursor = 'ew-resize';
        e.preventDefault();
      }

      // 拖动中
      function onDrag(e) {
        if (!isDragging) return;
        const percentage = getPercentageFromEvent(e);
        updateSliderPosition(percentage);
      }

      // 结束拖动
      function stopDrag() {
        if (isDragging) {
          isDragging = false;
          container.style.cursor = '';
        }
      }

      // 桌面端: 鼠标拖动
      container.addEventListener('mousedown', startDrag);
      document.addEventListener('mousemove', onDrag);
      document.addEventListener('mouseup', stopDrag);

      // 移动端: 触摸拖动
      container.addEventListener('touchstart', (e) => {
        startDrag(e);
      });

      container.addEventListener('touchmove', (e) => {
        if (isDragging) {
          e.preventDefault();
          onDrag(e);
        }
      }, { passive: false });

      document.addEventListener('touchend', stopDrag);

      // 初始化为该卡片的默认位置
      updateSliderPosition(defaultPosition);
    });
  }

  // ===== 标签切换 =====
  function handleTabClick(event) {
    const clickedTab = event.target.closest('.tools-showcase__tab');
    if (!clickedTab || isAnimating) return;

    const toolName = clickedTab.dataset.tool;
    if (toolName === currentTool) return;

    // 更新标签激活状态
    tabs.forEach(tab => tab.classList.remove('tools-showcase__tab--active'));
    clickedTab.classList.add('tools-showcase__tab--active');

    // 切换工具数据
    currentTool = toolName;
    currentCards = toolsData[currentTool];

    // 使用图片交叉淡入淡出
    isAnimating = true;

    // 先将所有对比图片淡出
    const allImages = carousel.querySelectorAll('.compare-image');
    allImages.forEach(img => {
      img.style.transition = 'opacity 0.2s ease';
      img.style.opacity = '0';
    });

    // 在图片淡出后切换
    setTimeout(() => {
      updateCardsDisplay();

      // 立即淡入新图片
      setTimeout(() => {
        allImages.forEach(img => {
          img.style.opacity = '1';
        });

        // 动画完成后清理
        setTimeout(() => {
          allImages.forEach(img => {
            img.style.transition = '';
          });
          isAnimating = false;
        }, 200);
      }, 50);
    }, 200);
  }

  // ===== 绑定事件监听器 =====
  function attachEventListeners() {
    window.addEventListener('resize', handleResize);

    // 标签切换
    tabs.forEach(tab => {
      tab.addEventListener('click', handleTabClick);
    });
  }

  // ===== 启动模块 =====
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }

})();
</script>
