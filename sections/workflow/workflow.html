<style>
/* ========================================
   Workflow 模块样式
   ======================================== */

.workflow {
  padding: var(--spacing-3xl) 0;
  background: var(--color-bg);
}

/* 标题区域 */
.workflow__header {
  text-align: center;
  max-width: 1120px; /* 增加宽度，减少换行 */
  margin: 0 auto 45px auto; /* 水平居中，底部45px间距 */
}

/* 小标题 "WORKFLOW" */
.workflow__subtitle {
  font-size: 1.2rem;
  font-weight: 600;
  letter-spacing: 0.1em;
  text-transform: uppercase;
  color: var(--color-text-secondary);
  margin-bottom: 0.1rem; /* 减小与主标题的间距 */
}

/* 主标题 "A Seamless Creative Workflow" */
.workflow__title {
  font-size: 2.8rem;
  font-weight: 700;
  line-height: 1.2;
  color: var(--color-text);
  margin-bottom: var(--spacing-lg); /* 增加与描述的间距 */
}

/* 描述文字 */
.workflow__description {
  font-size: 1.6rem;
  line-height: 1.6;
  color: var(--color-text-secondary);
  white-space: normal; /* 正常换行 */
  word-break: keep-all; /* 尽量不在单词中间断行 */
  word-wrap: break-word; /* 仅在必要时断词 */
}

/* 卡片网格 */
.workflow__cards {
  display: flex;
  gap: 27px; /* 减少卡片间距 */
  max-width: 1400px; /* 增加最大宽度，让卡片变宽，文字描述能一行显示更多 */
  margin: 0 auto;
  padding: 0 var(--spacing-lg);
}

/* 单个卡片 */
.workflow__card {
  position: relative;
  flex: 1 1 0; /* 默认平均分配空间 */
  aspect-ratio: 3 / 6.1;
  border-radius: 20px;
  overflow: hidden;
  cursor: pointer;
  transition: flex 0.5s cubic-bezier(0.4, 0, 0.2, 1); /* 只过渡flex属性 */
  background: #000000;
  will-change: flex; /* 性能优化 */
}

/* 悬浮状态：只增加宽度 */
.workflow__card:hover {
  flex: 2.5 1 0; /* 悬浮时占据更多宽度空间 */
  z-index: 10; /* 确保悬浮卡片在最上层 */
}

/* 当有卡片悬浮时，其他卡片收缩 */
.workflow__cards:has(.workflow__card:hover) .workflow__card:not(:hover) {
  flex: 0.6 1 0; /* 未悬浮卡片收缩宽度 */
}

/* 卡片图片 */
.workflow__card-image {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}

/* 步骤编号 - 固定在卡片底部左侧 */
.workflow__card-title-wrapper {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  margin-top: -5px;
}

.workflow__card-number {
  font-size: 2.5rem;
  font-weight: 700;
  color: rgba(255, 255, 255, 0.4);
  line-height: 1;
  position: absolute; /* 改为绝对定位 */
  bottom: 80px; /* 增加距离底部的距离 */
  left: 30px; /* 距离左侧固定距离 */
  z-index: 3; /* 确保在所有层之上 */
  transition: color 0.5s cubic-bezier(0.4, 0, 0.2, 1),
              bottom 0.5s cubic-bezier(0.4, 0, 0.2, 1),
              left 0.5s cubic-bezier(0.4, 0, 0.2, 1); /* 丝滑过渡动画 */
}

/* 悬浮时数字颜色加深并稍微下移 */
.workflow__card:hover .workflow__card-number {
  color: rgba(255, 255, 255, 0.9); /* 加深到90%不透明度 */
  bottom: 60px; /* 稍微下移一点 */
  left: 30px; /* 保持左侧位置 */
}

/* 渐变叠加层 - 从透明到纯黑 */
.workflow__card-overlay {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 60%;
  background: linear-gradient(
    to top,
    #000000 0%,
    rgba(0, 0, 0, 0.95) 15%,
    rgba(0, 0, 0, 0.85) 30%,
    rgba(0, 0, 0, 0.6) 50%,
    rgba(0, 0, 0, 0.3) 70%,
    transparent 100%
  );
  z-index: 1;
  opacity: 1;
  transition: opacity 0.3s ease; /* 淡出过渡 */
}

/* 悬浮时叠加层消失 */
.workflow__card:hover .workflow__card-overlay {
  opacity: 0;
}

/* 当有卡片悬浮时，所有未悬浮卡片的叠加层也淡出 */
.workflow__cards:has(.workflow__card:hover) .workflow__card:not(:hover) .workflow__card-overlay {
  opacity: 0;
}

/* 文字内容区域 */
.workflow__card-content {
  position: absolute;
  bottom: -25px;
  left: -15px;
  right: 0;
  padding: var(--spacing-lg);
  z-index: 2;
  opacity: 1;
  /* 不移动整个内容区域 */
}

/* 移除悬浮时文字消失的效果 */
/* 文字在放大缩小动画时保持显示 */

/* 标题样式 - 改为绝对定位 */
.workflow__card-title {
  font-size: 1.5rem;
  font-weight: 600;
  color: var(--color-text);
  position: absolute;
  bottom: 80px; /* 和数字同一高度 */
  left: 68px; 
  z-index: 3;
  transition: opacity 0.3s ease,
              bottom 0.5s cubic-bezier(0.4, 0, 0.2, 1),
              left 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}

/* 悬浮时标题稍微下移 */
.workflow__card:hover .workflow__card-title {
  bottom: 60px; /* 和数字同步下移到60px */
  left: 68px; /* 保持左边距 */
}

/* 描述文字样式 */
.workflow__card-text {
  font-size: 0.875rem;
  line-height: 1.5;
  color: #727272;
  margin: 0;
  transition: opacity 0.3s ease;
}

/* 当有卡片悬浮时，只隐藏其他未悬浮卡片的标题和描述 */
/* 被悬浮的卡片保留所有文字内容 */
.workflow__cards:has(.workflow__card:hover) .workflow__card:not(:hover) .workflow__card-title,
.workflow__cards:has(.workflow__card:hover) .workflow__card:not(:hover) .workflow__card-text {
  opacity: 0;
  pointer-events: none;
}

/* ========================================
   响应式设计
   ======================================== */

/* 平板端 */
@media (max-width: 991px) {
  .workflow {
    padding: var(--spacing-2xl) 0;
  }

  .workflow__title {
    font-size: 2.5rem;
  }

  .workflow__cards {
    display: grid; /* 平板端恢复grid布局 */
    grid-template-columns: repeat(2, 1fr);
    height: auto; /* 取消固定高度 */
  }

  /* 平板端取消悬浮动画 */
  .workflow__card {
    flex: none;
    height: auto; /* 取消固定高度 */
    aspect-ratio: 3 / 6.1; /* 恢复原始比例 */
  }

  .workflow__card:hover {
    flex: none;
    transform: translateY(-8px); /* 简单的上移效果 */
  }
}

/* 移动端 */
@media (max-width: 767px) {
  .workflow {
    padding: var(--spacing-xl) 0;
  }

  .workflow__header {
    margin-bottom: var(--spacing-xl);
  }

  .workflow__title {
    font-size: 2rem;
  }

  .workflow__description {
    font-size: 1rem;
  }

  .workflow__cards {
    grid-template-columns: 1fr;
    gap: var(--spacing-md);
  }

  .workflow__card {
    aspect-ratio: 3 / 3.5;
  }

  .workflow__card-number {
    font-size: 2.5rem;
    top: var(--spacing-sm);
    left: var(--spacing-sm);
  }

  .workflow__card-content {
    padding: var(--spacing-md);
  }

  .workflow__card-title {
    font-size: 1.25rem;
  }
}

/* 小屏手机 */
@media (max-width: 479px) {
  .workflow__title {
    font-size: 1.75rem;
  }

  .workflow__card-number {
    font-size: 2rem;
  }
}
</style>

<section class="workflow" id="workflow">
  <div class="container">
    <!-- 标题区域 -->
    <div class="workflow__header">
      <p class="workflow__subtitle">WORKFLOW</p>
      <h2 class="workflow__title">A Seamless Creative Workflow</h2>
      <p class="workflow__description">
        Every step is connected through the CLIP Engine and tracked by an
        intelligent assistant built to enhance your process.
      </p>
    </div>

    <!-- 卡片网格 -->
    <div class="workflow__cards">
      <!-- 卡片 1: Generative -->
      <div class="workflow__card" data-step="generative">
        <img
          src="sections/workflow/1.png"
          alt="Generative AI"
          class="workflow__card-image"
          loading="lazy"
        >
        <div class="workflow__card-overlay"></div>
        <div class="workflow__card-content">
          <div class="workflow__card-title-wrapper">
            <span class="workflow__card-number">1</span>
            <h3 class="workflow__card-title">Generative</h3>
          </div>
          <p class="workflow__card-text">
            Colors, fonts, lower thirds, logo safe-zones, intro/outro.
          </p>
        </div>
      </div>

      <!-- 卡片 2: Storyboard -->
      <div class="workflow__card" data-step="storyboard">
        <img
          src="sections/workflow/2.jpg"
          alt="Storyboard"
          class="workflow__card-image"
          loading="lazy"
        >
        <div class="workflow__card-overlay"></div>
        <div class="workflow__card-content">
          <div class="workflow__card-title-wrapper">
            <span class="workflow__card-number">2</span>
            <h3 class="workflow__card-title">Storyboard</h3>
          </div>
          <p class="workflow__card-text">
            Captures tone, pacing, motion and composition preferences.
          </p>
        </div>
      </div>

      <!-- 卡片 3: Timeline -->
      <div class="workflow__card" data-step="timeline">
        <img
          src="sections/workflow/3.png"
          alt="Timeline"
          class="workflow__card-image"
          loading="lazy"
        >
        <div class="workflow__card-overlay"></div>
        <div class="workflow__card-content">
          <div class="workflow__card-title-wrapper">
            <span class="workflow__card-number">3</span>
            <h3 class="workflow__card-title">Timeline</h3>
          </div>
          <p class="workflow__card-text">
            Brand recipes prevent drift and keep every render consistent.
          </p>
        </div>
      </div>

      <!-- 卡片 4: Assistant -->
      <div class="workflow__card" data-step="assistant">
        <img
          src="sections/workflow/4.png"
          alt="Assistant"
          class="workflow__card-image"
          loading="lazy"
        >
        <div class="workflow__card-overlay"></div>
        <div class="workflow__card-content">
          <div class="workflow__card-title-wrapper">
            <span class="workflow__card-number">4</span>
            <h3 class="workflow__card-title">Assistant</h3>
          </div>
          <p class="workflow__card-text">
            Brand recipes prevent drift and keep every render consistent.
          </p>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
(function() {
  'use strict';

  /**
   * 初始化 Workflow 模块
   */
  const initWorkflow = () => {
    console.log('✅ Workflow module initialized');

    const cards = document.querySelectorAll('.workflow__card');

    // 记录每张卡片的原始高度
    const originalHeights = new Map();

    // 等待布局稳定后记录高度
    setTimeout(() => {
      cards.forEach(card => {
        const height = card.offsetHeight;
        originalHeights.set(card, height);
        // 设置固定高度为内联样式
        card.style.height = `${height}px`;
      });
    }, 100);

    // 图片加载错误处理
    cards.forEach(card => {
      const img = card.querySelector('.workflow__card-image');

      if (img) {
        img.addEventListener('error', function() {
          console.warn(`Failed to load image: ${this.src}`);
          // 可以在这里设置占位图或处理逻辑
        });
      }
    });

    // 预留：未来可添加视频悬浮播放功能
    // 参考 gallery 模块的实现
    // const initVideoHover = () => { ... };

    // 预留：未来可添加点击展开详情功能
    // cards.forEach(card => {
    //   card.addEventListener('click', () => {
    //     const step = card.dataset.step;
    //     console.log(`Clicked on ${step}`);
    //     // 处理点击事件
    //   });
    // });
  };

  // DOM Ready 检测
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initWorkflow);
  } else {
    initWorkflow();
  }
})();
</script>
